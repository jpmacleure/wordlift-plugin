(function(){var a,b,c;a=jQuery,a.fn.extend({chord:function(b){var c,d,e,f,g,h;return h={dataEndpoint:void 0,mainColor:"#777",depth:2,maxLabelLength:30,maxWordLength:5,debug:!1},h=a.extend(h,b),d=a(this),g=function(){return a.ajax({type:"GET",url:h.dataEndpoint,data:{depth:h.depth},success:function(a){return c(a)}})},c=function(a){var b,c,e,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;if(null==a.entities||a.entities.length<2)return d.hide(),void f("No data found for the chord.");for(B=function(a,b,c,d){return"translate("+a*c+","+b*d+")"},x=function(a){return"rotate("+a+")"},t=function(a){return a/(2*Math.PI)*360},y=function(a){return a>=0?1:-1},c=function(a){var b,c,d,e;for(a.length>h.maxLabelLength&&(a=a.substring(0,h.maxLabelLength)+"..."),a=a.split(/\s/),c=[],e=b=0,d=a.length-1;d>=0?d>=b:b>=d;e=d>=0?++b:--b)a[e].length>h.maxWordLength||e===a.length-1?c.push(a[e]):a[e+1]=a[e]+" "+a[e+1];return c},g=function(a,b){var c,d,e,f;for(a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0,f="#",c=void 0,d=void 0,d=e=0;3>=e;d=++e)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),f+=("00"+c).substr(c.length);return f},k=function(b){var c,d,e;for(c=d=0,e=a.entities.length;e>=0?e>=d:d>=e;c=e>=0?++d:--d)if(a.entities[c].uri===b)return c;return-1},r=[],u=a.entities,n=0,p=u.length;p>n;n++)j=u[n],r.push(function(){var b,c,d,e;for(d=a.entities,e=[],b=0,c=d.length;c>b;b++)i=d[b],e.push(0);return e}());for(v=a.relations,o=0,q=v.length;q>o;o++)w=v[o],E=k(w.s),F=k(w.o),r[E][F]=1,r[F][E]=1;return C=d3.select("#"+d.attr("id")).append("svg"),C.attr("width","100%").attr("height","100%"),D=parseInt(C.style("width")),l=parseInt(C.style("height")),z=D>l?l:D,m=.2*z,s=.25*z,b=d3.svg.arc().innerRadius(m).outerRadius(s),e=d3.layout.chord().padding(.3).matrix(r),C.selectAll("chords").data(e.chords).enter().append("path").attr("class","relation").attr("d",d3.svg.chord().radius(m)).attr("transform",B(.5,.5,D,l)).style("opacity",.2).on("mouseover",function(){return d3.select(this).style("opacity",.8)}).on("mouseout",function(){return d3.select(this).style("opacity",.2)}),C.selectAll("arcs").data(e.groups).enter().append("path").attr("class",function(b){return"entity "+a.entities[b.index].css_class}).attr("d",b).attr("transform",B(.5,.5,D,l)).style("fill",function(b){var c,d;return c=h.mainColor,d=a.entities[b.index].type,"post"===d?c:"entity"===d?g(c,-.5):g(c,.5)}),C.selectAll("arcs_labels").data(e.groups).enter().append("text").attr("class","label").attr("font-size",function(){var a;return a=parseInt(z/35),8>a&&(a=8),a+"px"}).each(function(b){var d,e,f,g,h;for(f=c(a.entities[b.index].label),h=d3.select(this).attr("dy",f.length/3-.9*(f.length-1)+"em").text(f[0]),d=e=1,g=f.length;g>=1?g>=e:e>=g;d=g>=1?++e:--e)h.append("tspan").attr("x",0).attr("dy","1em").text(f[d]);return h.attr("transform",function(a){var b,c,d,e,f;return b=a.startAngle-Math.PI/2+Math.abs((a.endAngle-a.startAngle)/2),d=3,c=void 0,b>Math.PI/2?(c=b-Math.PI,d+=d3.select(this)[0][0].clientWidth):c=b,c=t(c),e=(s+d)/D,f=(s+d)/l,E=.5+e*Math.cos(b),F=.5+f*Math.sin(b),B(E,F,D,l)+x(c)}).attr("text-anchor",function(a){var b,c;return c=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,b=a.startAngle+Math.abs((a.endAngle-a.startAngle)/2),c&&b>Math.PI?"end":null})}),A=d3.select("body").append("div").attr("class","tooltip").style("background-color","white").style("color","black").style("opacity",0).style("position","absolute").style("z-index",100),C.selectAll(".entity, .label").on("mouseover",function(b){return d3.select(this).attr("cursor","pointer"),C.selectAll(".relation").filter(function(a,c){return a.source.index===b.index||a.target.index===b.index}).style("opacity",.8),A.text(a.entities[b.index].label).style("opacity",1)}).on("mouseout",function(a){return C.selectAll(".relation").filter(function(b,c){return b.source.index===a.index||b.target.index===a.index}).style("opacity",.2),A.style("opacity",0)}).on("mousemove",function(){return A.style("left",d3.event.pageX+"px").style("top",d3.event.pageY-30+"px")}).on("click",function(b){var c;return c=a.entities[b.index].url,window.location=c})},e=function(){return g()},f=function(a){return h.debug&&"undefined"!=typeof console&&null!==console?console.log(a):void 0},e()}}),jQuery(function(a){return a(".wl-chord").each(function(){var b,c,d;return b=a(this),c=b.data(),a.extend(c,wl_chord_params),d=c.ajax_url+"?"+a.param({action:c.action,post_id:c.postId}),b.chord({dataEndpoint:d,depth:c.depth,mainColor:c.mainColor})})}),a=jQuery,a.fn.extend({timeline:function(b){var c,d,e,f,g,h;return h={dataEndpoint:void 0,width:"100%",height:"600",debug:!1},h=a.extend(h,b),d=a(this),g=function(){return a.ajax({type:"GET",url:h.dataEndpoint,success:function(a){return c(a)}})},c=function(a){return null!=a.timeline?createStoryJS({type:"timeline",width:h.width,height:h.height,source:a,embed_id:d.attr("id"),start_at_slide:a.startAtSlide}):(d.hide(),void f("Timeline data missing: timeline cannot be rendered"))},e=function(){return g()},f=function(a){return h.debug&&"undefined"!=typeof console&&null!==console?console.log(a):void 0},e()}}),jQuery(function(a){return a(".wl-timeline").each(function(){var b,c,d;return b=a(this),c=b.data(),a.extend(c,wl_timeline_params),d=c.ajax_url+"?"+a.param({action:c.action,post_id:c.postId}),a(this).timeline({dataEndpoint:d})})}),a=jQuery,a.fn.extend({geomap:function(b){var c,d,e,f,g,h;return h={dataEndpoint:void 0,zoom:13,debug:!1},h=a.extend(h,b),d=a(this),e=function(){return g()},g=function(){return a.ajax({type:"GET",url:h.dataEndpoint,success:function(a){return c(a)}})},c=function(a){var b,c,e;return null==a.features||0===(null!=(c=a.features)?c.length:void 0)?(d.hide(),void f("Features missing: geomap cannot be rendered")):(b=L.map(d.attr("id")),1===(null!=(e=a.boundaries)?e.length:void 0)?b.setView(a.boundaries[0],h.zoom):b.fitBounds(L.latLngBounds(a.boundaries)),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(b),L.geoJson(a.features,{pointToLayer:function(a,b){return L.marker(b,{})},onEachFeature:function(a,b){var c;return(null!=(c=a.properties)?c.popupContent:void 0)?b.bindPopup(a.properties.popupContent):void 0}}).addTo(b))},f=function(a){return h.debug&&"undefined"!=typeof console&&null!==console?console.log(a):void 0},e()}}),jQuery(function(a){return a(".wl-geomap").each(function(){var b,c,d;return b=a(this),c=b.data(),a.extend(c,wl_geomap_params),d=c.ajax_url+"?"+a.param({action:c.action,post_id:c.postId}),b.geomap({dataEndpoint:d})})}),angular.module("wordlift.ui.carousel",["ngTouch"]).directive("wlCarousel",["$window","$log",function(a,b){return{restrict:"A",scope:!0,transclude:!0,template:'<div class="wl-carousel" ng-class="{ \'active\' : areControlsVisible }" ng-show="panes.length > 0" ng-mouseover="showControls()" ng-mouseleave="hideControls()">\n  <div class="wl-panes" ng-style="{ width: panesWidth, left: position }" ng-transclude ng-swipe-left="next()" ng-swipe-right="prev()" ></div>\n  <div class="wl-carousel-arrows" ng-show="areControlsVisible" ng-class="{ \'active\' : isActive() }">\n    <i class="wl-angle left" ng-click="prev()" ng-show="isPrevArrowVisible()" />\n    <i class="wl-angle right" ng-click="next()" ng-show="isNextArrowVisible()" />\n  </div>\n</div>',controller:["$scope","$element","$attrs","$log",function(b,c,d,e){var f,g;return g=angular.element(a),b.setItemWidth=function(){return c.width()/b.visibleElements()},b.showControls=function(){return b.areControlsVisible=!0},b.hideControls=function(){return b.areControlsVisible=!1},b.visibleElements=function(){return c.width()>460?4:1},b.isActive=function(){return b.isPrevArrowVisible()||b.isNextArrowVisible()},b.isPrevArrowVisible=function(){return b.currentPaneIndex>0},b.isNextArrowVisible=function(){return b.panes.length-b.currentPaneIndex>b.visibleElements()},b.next=function(){return b.currentPaneIndex+b.visibleElements()+1>b.panes.length?void 0:(b.position=b.position-b.itemWidth,b.currentPaneIndex=b.currentPaneIndex+1)},b.prev=function(){return 0!==b.currentPaneIndex?(b.position=b.position+b.itemWidth,b.currentPaneIndex=b.currentPaneIndex-1):void 0},b.setPanesWrapperWidth=function(){return b.panesWidth=b.panes.length*b.itemWidth,b.position=0,b.currentPaneIndex=0},b.itemWidth=b.setItemWidth(),b.panesWidth=void 0,b.panes=[],b.position=0,b.currentPaneIndex=0,b.areControlsVisible=!1,g.bind("resize",function(){var a,c,d,e;for(b.itemWidth=b.setItemWidth(),b.setPanesWrapperWidth(),e=b.panes,a=0,c=e.length;c>a;a++)d=e[a],d.scope.setWidth(b.itemWidth);return b.$apply()}),f=this,f.registerPane=function(a,c,d){var e;return a.setWidth(b.itemWidth),e={scope:a,element:c},b.panes.push(e),b.setPanesWrapperWidth()},f.unregisterPane=function(a){var c,d,e,f,g,h;for(h=void 0,g=b.panes,c=d=0,e=g.length;e>d;c=++d)f=g[c],f.scope.$id===a.$id&&(h=c);return b.panes.splice(h,1),b.setPanesWrapperWidth()}}]}}]).directive("wlCarouselPane",["$log",function(a){return{require:"^wlCarousel",restrict:"EA",scope:{wlFirstPane:"="},transclude:!0,template:"<div ng-transclude></div>",link:function(b,c,d,e){return c.addClass("wl-carousel-item"),b.isFirst=b.wlFirstPane||!1,b.setWidth=function(a){return c.css("width",a+"px")},b.$on("$destroy",function(){return a.debug("Destroy "+b.$id),e.unregisterPane(b)}),e.registerPane(b,c,b.isFirst)}}}]),angular.module("wordlift.utils.directives",[]).directive("wlOnError",["$parse","$window","$log",function(a,b,c){return{restrict:"A",compile:function(b,c){return function(b,d){var e;return e=a(c.wlOnError),d.on("error",function(a){var c;return c=function(){return e(b,{$event:a})},b.$apply(c)})}}}}]).directive("wlFallback",["$window","$log",function(a,b){return{restrict:"A",priority:99,link:function(a,c,d,e){return c.bind("error",function(){return d.src!==d.wlFallback?(b.warn("Error on "+d.src+"! Going to fallback on "+d.wlFallback),d.$set("src",d.wlFallback)):void 0})}}}]).directive("wlHideAfter",["$timeout","$log",function(a,b){return{restrict:"A",link:function(c,d,e,f){var g;return g=+e.wlHideAfter,a(function(){return b.debug("Remove msg after "+g+" ms"),d.hide()},g)}}}]).directive("wlClipboard",["$timeout","$document","$log",function(a,b,c){return{restrict:"E",scope:{text:"=",onCopied:"&"},transclude:!0,template:'<span \n  class="wl-widget-post-link" \n  ng-class="{\'wl-widget-post-link-copied\' : $copied}"\n  ng-click="copyToClipboard()">\n  <ng-transclude></ng-transclude>\n  <input type="text" ng-value="text" />\n</span>',link:function(d,e,f,g){return d.$copied=!1,d.node=e.find("input"),d.node.css("position","absolute"),d.node.css("left","-10000px"),d.copyToClipboard=function(){var e;try{if(b[0].body.style.webkitUserSelect="initial",e=b[0].getSelection(),e.removeAllRanges(),d.node.select(),b[0].execCommand("copy")||c.warn("Error on clipboard copy for "+text),e.removeAllRanges(),d.$copied=!0,a(function(){return c.debug("Going to reset $copied status"),d.$copied=!1},3e3),angular.isFunction(d.onCopied))return d.$evalAsync(d.onCopied())}finally{b[0].body.style.webkitUserSelect=""}}}}}]),a=jQuery,angular.module("wordlift.navigator.widget",["wordlift.ui.carousel","wordlift.utils.directives"]).provider("configuration",function(){var a,b;return a=void 0,b={setConfiguration:function(b){return a=b},$get:function(){return a}}}).directive("wlNavigatorItems",["configuration","$window","$log",function(a,b,c){return{restrict:"E",scope:!0,template:function(b,c){var d,e,f,g,h;return h="wl-wrapper",g=" wl-carousel",e="wl-post wl-card wl-item-wrapper",d=" wl-carousel-pane",f="wl-card-image",a.attrs.with_carousel||(h="wl-floating-wrapper",g="",e="wl-post wl-card wl-floating-item-wrapper",d=""),a.attrs.squared_thumbs&&(f="wl-card-image wl-square"),'<div class="wl-posts">\n  <div class="'+h+'" '+g+'>\n    <div class="'+e+'" ng-repeat="item in items"'+d+'>\n      <div class="wl-card-header wl-entity-wrapper">\n        <h6>\n          <a ng-href="{{item.entity.permalink}}">{{item.entity.label}}</a>\n        </h6>\n      </div>\n      <div class="'+f+'">\n        <a ng-href="{{item.post.permalink}}" style="background: url({{item.post.thumbnail}}) no-repeat center center; background-size: cover;"></a>\n      </div>\n      <div class="wl-card-title">\n        <a ng-href="{{item.post.permalink}}">{{item.post.title}}</a>\n      </div>\n    </div>\n  </div>\n</div>'}}}]).controller("NavigatorWidgetController",["DataRetrieverService","configuration","$scope","$log",function(a,b,c,d){return c.items=[],c.configuration=b,c.$on("itemsLoaded",function(a,b){return c.items=b})}]).service("DataRetrieverService",["configuration","$log","$http","$rootScope",function(a,b,c,d){var e;return e={},e.load=function(){var e;return e=a.ajax_url+"?action="+a.action+"&post_id="+a.post_id,b.debug("Going to load navigator items from "+e),c({method:"get",url:e}).success(function(a){return d.$broadcast("itemsLoaded",a)}).error(function(a,c){return b.warn("Error loading items, statut "+c)})},e}]).config(["configurationProvider",function(a){return a.setConfiguration(window.wl_navigator_params)}]),a(b=a('<div ng-controller="NavigatorWidgetController" ng-show="items.length > 0">\n      <h4 class="wl-headline">{{configuration.attrs.title}}</h4>\n      <wl-navigator-items></wl-navigator-items>\n    </div>').appendTo(".wl-navigator-widget"),c=angular.bootstrap(a(".wl-navigator-widget"),["wordlift.navigator.widget"]),c.invoke(["DataRetrieverService","$rootScope","$log",function(a,b,c){return b.$apply(function(){return a.load()})}]))}).call(this);